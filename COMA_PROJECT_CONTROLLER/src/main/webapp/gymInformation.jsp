<%@ page language="java" contentType="text/html; charset=UTF-8"
   pageEncoding="UTF-8"%>
<%@ taglib tagdir="/WEB-INF/tags" prefix="mytag"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c"%>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>ÏïîÎ≤ΩÏû• ÏÉÅÏÑ∏ ÌéòÏù¥ÏßÄ</title>

<!-- Fonts and icons -->
<script src="assets/js/plugin/webfont/webfont.min.js"></script>
<script src="https://kit.fontawesome.com/7f7b0ec58f.js"
   crossorigin="anonymous"></script>

<!-- CSS Files -->
<link rel="stylesheet" href="assets/css/bootstrap.min.css" />
<link rel="stylesheet" href="assets/css/plugins.min.css" />
<link rel="stylesheet" href="assets/css/kaiadmin.css" />
<link rel="stylesheet"
   href="https://code.jquery.com/ui/1.13.2/themes/base/jquery-ui.css">

<style>
/*
.img-box {
   width: 1200px;
   height: 400px;
   background: url("images/1.jpg") no-repeat;
   background-size: cover;
}
*/
.img-btn {
   position: absolute;
   right: 30px;
   bottom: 30px;
}
</style>



</head>
<body>

   <!-- ÏÉÅÎã® ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò Î∞î -->
   <mytag:gnb member_id="${MEMBER_ID}"></mytag:gnb>

   <!-- Î©îÏù∏ Ïª®ÌÖåÏù¥ÎÑà: ÏïîÎ≤ΩÏû• Ï†ïÎ≥¥ -->
   <div class="container pt-3">
      <div class="page-inner">
         <div class="col-md-12">
            <div class="card card-stats card-round p-3">

               <!-- ÏïîÎ≤ΩÏû• Ïù¥Î¶Ñ -->
               <div class="card-header">
                  <div class="card-title">${model_gym_name}</div>
               </div>
               <div class="card-body">
                  <!-- ÏïîÎ≤ΩÏû• ÏÇ¨ÏßÑ / Ï¢ãÏïÑÏöî -->
                  <div class="row">
                     <div class="col-12 position-relative overflow-hidden"
                        style="height: 400px;">
                        <input type="hidden" id="gymNum" name="VIEW_GYM_NUM" value="${model_gym_num}">
                        <c:if test="${model_favorite == 'delete'}">
                        <button
                           class="btn btn-info img-btn position-absolute z-3 rounded-3"
                           id="favorite">ü§ç</button>
                        </c:if>
                        <c:if test="${empty model_favorite}">
                        <button
                           class="btn btn-info img-btn position-absolute z-3 rounded-3"
                           id="favorite">ü§ç</button>
                        </c:if>
                        <c:if test="${model_favorite == 'insert'}">
                        <button
                           class="btn btn-info img-btn position-absolute z-3 rounded-3"
                           id="favorite">‚ù§Ô∏è</button>
                        </c:if>
                        <img src="${model_gym_profile}" alt=""
                           class="w-50 position-absolute z-0 "style="margin-left:300px">
                     </div>
                  </div>
                  <!-- ÏòàÏïΩ / Ïã†Ï≤≠ -->
                  <div class="row pt-4">
                     <div class="col-6">
                        <button type="button" class="btn btn-secondary  w-100 col-md-3"
                           id="reservation">ÏòàÏïΩ</button>
                     </div>
                     <div class="col-6">
                        <button type="button" class="btn btn-primary w-100 col-md-3"
                           id="crewMatch">Ïã†Ï≤≠</button>
                     </div>
                  </div>
                  <div class="row pt-5">
                     <div class="col-4">
                        <!-- ÏÜåÍ∞úÍ∏Ä -->
                        <div class="card card-stats card-round p-3 col-md-5  w-100">
                           <div class="card-header">
                              <div class="card-title">ÏïîÎ≤ΩÏû• ÏÜåÍ∞ú</div>
                           </div>
                           <div class="card-body">
                              <p>${model_gym_description}</p>
                              <div id="gymNum" style="display: none;">${model_gym_num}</div>
                           </div>
                        </div>
                     </div>
                     <div class="col-8">
                        <!-- Ïó≠ÎåÄ ÏäπÎ¶¨ÌÅ¨Î£® / MVP -->
                        <div class="card card-stats card-round p-3 col-md-5 w-100">
                           <div class="card-header d-flex align-itemss-center">
                              <div class="card-title">Ïó≠ÎåÄÏäπÎ¶¨ÌÅ¨Î£®</div>
                              <button type="button" id="crewMore" class="btn btn-info ms-5">
                                 >> more</button>
                           </div>
                           <div class="card-body">
                              <div class="row">
                                 <c:forEach var="data" items="${model_battle_record_datas}" begin="0" end="3">
                                 <div class="col-3 d-flex flex-column align-items-center">
                                    <div class="avatar avatar-xl">
                                       <img src="${data.model_battle_record_crew_profile}" alt="..."
                                          class="avatar-img rounded-circle">
                                    </div>
                                    <small>${data.model_battle_record_crew_name}</small>
                                    <small>${data.model_battle_record_game_date}</small>
                                 </div>
                                 </c:forEach>
                              </div>
                           </div>
                        </div>
                     </div>

                  </div>
               </div>
               <div class="row">
                  <div class="col-12">
                     <!-- Ïó≠ÎåÄ ÏäπÎ¶¨ÌÅ¨Î£® / Ïó≠ÎåÄ MVP ÎçîÎ≥¥Í∏∞ -->
                     <div class="card card-stats card-round p-3 d-none"
                        id="crewMoreBox">
                        <div class="card-title">Ïó≠ÎåÄÏäπÎ¶¨ÌÅ¨Î£® Î∞è MVP</div>
                        <div class="card-body">
                           <div class="d-flex align-items-center">
                              <p class="col-md-4">ÏäπÎ¶¨ÌÅ¨Î£®</p>
                              <p class="col-md-4">ÏäπÎ¶¨ÎÇ†Ïßú</p>
                              <p class="col-md-4">MVP</p>
                           </div>
                           <hr>
                           <c:forEach var="allData" items="${model_battle_record_datas}">
                           <div class="d-flex align-items-center">
                              <p class="col-md-4">${allData.model_battle_record_crew_name}</p>
                              <p class="col-md-4">${allData.model_battle_record_game_date}</p>
                              <p class="col-md-4">${allData.model_battle_record_mvp_id}</p>
                           </div>
                           </c:forEach>
                        </div>
                     </div>
                  </div>
               </div>


            </div>
         </div>
      </div>
   </div>

   <!-- ÏòàÏïΩ modal -->
   <div class="modal fade" id="reservationModal" tabindex="-1"
      role="dialog" aria-labelledby="reservationModalLabel"
      aria-hidden="true">
      <div class="modal-dialog" role="document">
         <div class="modal-content">
            <div class="modal-header">
               <h5 class="modal-title" id="reservationModalLabel">ÏòàÏïΩ</h5>
               <button type="button" class="close" data-dismiss="modal"
                  aria-label="Close">
                  <span aria-hidden="true">&times;</span>
               </button>
            </div>
            <div class="modal-body">
               <form action="GymReservationInformationPage.do">
                  <div class="form-group">
                  <input type="hidden" id="gymNum" name="VIEW_RESERVATION_GYM_NUM" value="${model_gym_num}">
                  <input type="hidden" name="VIEW_RESERVATION_PRICE" value="${model_gym_price}">
                     Í∞ÄÍ≤© : ${model_gym_price} Ïõê
                     <div class="d-flex align-items-center">
                        
                        ÎÇ†Ïßú : <input type="text" id="reservationDatepicker" name="VIEW_RESERVATION_DATE" required>
                        
                     </div>
                     <input type="radio" id="pointUse"> <label>Ìè¨Ïù∏Ìä∏
                        ÏÇ¨Ïö©ÌïòÍ∏∞</label>
                     <div class="form-group d-none" id="point">
                        <p>Î≥¥Ïú†Ìè¨Ïù∏Ìä∏ : ${model_gym_member_current_point} pt</p>
                        ÏÇ¨Ïö©Ìè¨Ïù∏Ìä∏ :<c:if test="${model_gym_member_current_point < 5000}">
                           <input type="number" name="VIEW_USE_POINT" max="${model_gym_member_current_point}" step="1" value="0"> pt
                        </c:if>
                        <c:if test="${model_gym_member_current_point >= 5000}">
                           <input type="number" name="VIEW_USE_POINT" max="5000" step="1" value="0"> pt
                        </c:if>
                     </div>
                     <div class="form-group">
                        <button type="submit" class="btn btn-primary"
                           id="reservation-btn">ÏòàÏïΩ</button>
                        <small class="error" id="fileError"></small>
                     </div>
                  </div>
               </form>
            </div>
            <div class="modal-footer">
               <button type="button" class="btn btn-secondary"
                  data-dismiss="modal" id="reservationClose">Îã´Í∏∞</button>
            </div>
         </div>
      </div>
   </div>

   <!-- ÌÅ¨Î£®Ï†Ñ Ïã†Ï≤≠ modal -->
   <c:if test="${empty model_gym_battle_game_date}">
   <div class="modal fade" id="crewMatchModal" tabindex="-1" role="dialog"
      aria-labelledby="crewMatchModalLabel" aria-hidden="true">
      <div class="modal-dialog" role="document">
         <div class="modal-content">
            <div class="modal-header">
               <h5 class="modal-title" id="crewMatchModalLabel">ÌÅ¨Î£®Ï†Ñ Ïã†Ï≤≠</h5>
               <button type="button" class="close" data-dismiss="modal"
                  aria-label="Close">
                  <span aria-hidden="true">&times;</span>
               </button>
            </div>
            <div class="modal-body">
               <form action="CrewBattleApplication.do">
                  <div class="form-group">
                     <input type="hidden" name="VIEW_CREW_BATTLE_GYM_NUM" value="${model_gym_num}">
                     <input type="hidden" name="VIEW_CREW_BATTLE_NUM" value="${model_battle_num}">
                        Ïã†Ï≤≠ ÎÇ†Ïßú : <input type="text" id="crewMatchDatepicker" name="VIEW_CREW_BATTLE_DATE" required>
                     
                     
                     <div class="form-group">
                        <button type="submit" class="btn btn-primary" id="crewMatch-btn">Í∞úÏµú Ïã†Ï≤≠</button>
                        <small class="error" id="fileError"></small>
                     </div>
                  </div>
               </form>
            </div>
            <div class="modal-footer">
               <button type="button" class="btn btn-secondary"
                  data-dismiss="modal" id="crewMatchClose">Îã´Í∏∞</button>
            </div>
         </div>
      </div>
   </div>
   </c:if>
   
   <c:if test="${not empty model_gym_battle_game_date}">
   <div class="modal fade" id="crewMatchModal" tabindex="-1" role="dialog"
      aria-labelledby="crewMatchModalLabel" aria-hidden="true">
      <div class="modal-dialog" role="document">
         <div class="modal-content">
            <div class="modal-header">
               <h5 class="modal-title" id="crewMatchModalLabel">ÌÅ¨Î£®Ï†Ñ Í∞úÏµú</h5>
               <button type="button" class="close" data-dismiss="modal"
                  aria-label="Close">
                  <span aria-hidden="true">&times;</span>
               </button>
            </div>
            <div class="modal-body">
               <form action="CrewBattleApplication.do">
                  <div class="form-group">
                     <input type="hidden" name="VIEW_CREW_BATTLE_GYM_NUM" value="${model_gym_num}">
                     <input type="hidden" name="VIEW_CREW_BATTLE_NUM" value="${model_battle_num}"> <!--Ï∂îÍ∞ÄÌñàÏäµÎãàÎã§..-->
                     Í∞úÏµúÏùº : <input type="text" name="VIEW_CREW_BATTLE_DATE"  value="${model_gym_battle_game_date}" readonly>
                     <!-- Ï∂îÌõÑÏóê ÏÉÅÍ∏àÏùÄ Í¥ÄÎ¶¨Ïûê ÌéòÏù¥ÏßÄÏóêÏÑú ÏÑ§Ï†ï Í∞ÄÎä•ÌïòÍ≤å Íµ¨ÌòÑ -->
                     <p>ÏÉÅÍ∏à 10,000pt</p>
                     <div class="form-group">
                        <button type="submit" class="btn btn-primary" id="crewMatch-btn">ÌÅ¨Î£®Ï†ÑÏã†Ï≤≠</button>
                        <small class="error" id="fileError"></small>
                     </div>
                  </div>
               </form>
            </div>
            <div class="modal-footer">
               <button type="button" class="btn btn-secondary"
                  data-dismiss="modal" id="crewMatchClose">Îã´Í∏∞</button>
            </div>
         </div>
      </div>
   </div>
   </c:if>

   <!-- Core JS Files -->
   <script src="assets/js/core/jquery-3.7.1.min.js"></script>
   <script src="assets/js/core/popper.min.js"></script>
   <script src="assets/js/core/bootstrap.min.js"></script>
   <script src="https://code.jquery.com/ui/1.13.2/jquery-ui.js"></script>

   <script>
      $(document).ready(function() {
         

         // >> more Î≤ÑÌäº ÌÅ¥Î¶≠Ìï®Ïàò
         $("#crewMore").click(function() {
            $("#crewMoreBox").removeClass("d-none");
         });

         // >> ÏòàÏïΩ Î™®Îã¨Ï∞Ω Ìï®Ïàò
         $('#crewMatch').click(function() {
            $('#crewMatchModal').modal('show');
         });
         $('#crewMatchModal .close').click(function() {
            $('#crewMatchModal').modal('hide');
         });
         $('#crewMatchClose').click(function() {
            $('#crewMatchModal').modal('hide');
         });

         // >> ÌÅ¨Î£®Ï†Ñ Ïã†Ï≤≠ Î™®Îã¨Ï∞Ω Ìï®Ïàò
         $('#reservation').click(function() {
            $('#reservationModal').modal('show');
         });
         $('#reservationModal .close').click(function() {
            $('#reservationModal').modal('hide');
         });
         $('#reservationClose').click(function() {
            $('#reservationModal').modal('hide');
         });

         // Ìè¨Ïù∏Ìä∏ ÏÇ¨Ïö©ÌïòÍ∏∞ radio Ï≤¥ÌÅ¨ Ïãú Ìï®Ïàò
         $('#pointUse').click(function() {
            $("#point").removeClass("d-none");
         });
         // Îç∞Ïù¥Ìä∏ ÌîºÏª§ Ìï®Ïàò
         $(function() {
            $("#reservationDatepicker").datepicker({
                 dateFormat: "yy-mm-dd", // ÎÇ†Ïßú ÌòïÏãùÏùÑ ÏõêÌïòÎäî ÌòïÏãùÏúºÎ°ú ÏÑ§Ï†ï
                 changeMonth: true,
                 changeYear: true
             });
            $("#crewMatchDatepicker").datepicker({
                 dateFormat: "yy-mm-dd", // ÎÇ†Ïßú ÌòïÏãùÏùÑ ÏõêÌïòÎäî ÌòïÏãùÏúºÎ°ú ÏÑ§Ï†ï
                 changeMonth: true,
                 changeYear: true
             });
         });
         // Ìè¨Ïù∏Ìä∏ ÏÇ¨Ïö©ÌïòÍ∏∞ radio Ï≤¥ÌÅ¨ Ïãú Ìï®Ïàò
         $('.img-btn').click(function() {
            // Ï¢ãÏïÑÏöî id
            var favoriteField = document.getElementById('favorite');
            // gymNum PK Í∞í
            var gymNumField = document.getElementById('gymNum');
            var gymNum = gymNumField.value;
            $.ajax({
                     type: "POST",
                     url: "GymFavorite", // ÏÑúÎ≤ÑÏóêÏÑú Ï¢ãÏïÑÏöî ÎàåÎ†ÄÎäîÏßÄ ÌôïÏù∏
                     data: { // POSTÎ°ú Î≥¥ÎÇºÎïåÏóêÎäî dataÎ°ú Î≥¥ÎÇ∏Îã§~!
                        view_favorite_gym_num: gymNum
                     },
                     success: function(data) {
                         if (data =='delete') { // CÌïúÌÖå Î∞õÏïÑÏò® Í∞íÏù¥ deleteÎùºÎ©¥
                            $(favoriteField).text('ü§ç'); // ÏÉâ ÏóÜÏùå
                         }
                         else if(data == 'insert'){ // CÌïúÌÖå Î∞õÏïÑÏò® Í∞íÏù¥ insertÎùºÎ©¥
                            $(favoriteField).text('‚ù§Ô∏è'); // Îπ®Í∞ÑÏÉâ
                         }
                         else { // Î∞õÏïÑÏò® Í∞íÏù¥ ÏóÜÎã§Î©¥
                            alert("Ï∞úÎ™©Î°ùÏùÑ Î∂àÎü¨Ïò§ÏßÄ Î™ªÌñàÏäµÎãàÎã§. Îã§Ïãú ÏãúÎèÑÌï¥Ï£ºÏÑ∏Ïöî");
                            return false;
                         }
                     },
                     error: function(error) {
                        alert("ÏÑúÎ≤ÑÏò§Î•òÏûÖÎãàÎã§~!");
                     }
                 });
         });
         
      });
   </script>

</body>
</html>