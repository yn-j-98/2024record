CREATE TABLE CREW_BOARD(
	CREW_BOARD_NUM INT PRIMARY KEY,					--크루게시판 PK
	CREW_BOARD_WRITER_ID VARCHAR(100) NOT NULL,		--크루게시판 작성자 FK
	CREW_BOARD_CONTENT VARCHAR(200),				--크루게시판 글 내용
	CREW_BOARD_TITLE VARCHAR(50) NOT NULL,			--크루게시판 글 제목
	CREW_BOARD_CNT INT DEFAULT 0,					--크루게시판 글 조회수
	
	--외래키 제약조건 설정
	--작성자
	CONSTRAINT FK_CREW_BOARD_WRITER_ID
	FOREIGN KEY (CREW_BOARD_WRITER_ID)
	REFERENCES MEMBER(MEMBER_ID)
	ON DELETE CASCADE
);

INSERT INTO CREW_BOARD(CREW_BOARD_NUM,CREW_BOARD_WRITER_ID,CREW_BOARD_CONTENT,CREW_BOARD_TITLE)
VALUES ((SELECT NVL(MAX(CREW_BOARD_NUM),0)+1 FROM CREW_BOARD),'샘플유저1','crew_board_content1','crew_board_title1');

INSERT INTO CREW_BOARD(CREW_BOARD_NUM,CREW_BOARD_WRITER_ID,CREW_BOARD_CONTENT,CREW_BOARD_TITLE)
VALUES ((SELECT NVL(MAX(CREW_BOARD_NUM),0)+1 FROM CREW_BOARD),'샘플유저2','crew_board_content2','crew_board_title2');

INSERT INTO CREW_BOARD(CREW_BOARD_NUM,CREW_BOARD_WRITER_ID,CREW_BOARD_CONTENT,CREW_BOARD_TITLE)
VALUES ((SELECT NVL(MAX(CREW_BOARD_NUM),0)+1 FROM CREW_BOARD),'샘플유저3','crew_board_content3','crew_board_title3');



--PK로 검색 CREW_BOARD_NUM
SELECT CREW_BOARD_NUM,CREW_BOARD_WRITER_ID,CREW_BOARD_CONTENT,CREW_BOARD_CNT FROM CREW_BOARD WHERE CREW_BOARD_NUM = ?;

--ID로 찾기 
SELECT 
	C.CREW_BOARD_NUM,
	M.MEMBER_NAME,
	C.CREW_BOARD_CONTENT,
	C.CREW_BOARD_TITLE
FROM 
	CREW_BOARD C
JOIN 
    MEMBER M
ON 
    C.CREW_BOARD_WRITER_ID = M.MEMBER_ID
WHERE CREW_BOARD_WRITER_ID = '샘플유저1';

--ID로 검색 (ALL_SEARCH_ID)
SELECT
	CREW_BOARD_PAGENATION.CRN,
	CREW_BOARD_PAGENATION.CREW_BOARD_NUM,
    CREW_BOARD_PAGENATION.CREW_BOARD_TITLE,
    CREW_BOARD_PAGENATION.CREW_BOARD_CONTENT,
    CREW_BOARD_PAGENATION.CREW_BOARD_WRITER_ID,
    CREW_BOARD_PAGENATION.CREW_BOARD_CNT
FROM (
    SELECT 
        CREW_BOARD_NUM, 
        CREW_BOARD_TITLE, 
        CREW_BOARD_CONTENT, 
        CREW_BOARD_WRITER_ID,
        CREW_BOARD_CNT,
        ROW_NUMBER() OVER (ORDER BY CREW_BOARD_NUM DESC) AS CRN
    FROM 
        CREW_BOARD
) CREW_BOARD_PAGENATION
JOIN
	MEMBER M
ON
	M.MEMBER_ID = CREW_BOARD_PAGENATION.CREW_BOARD_WRITER_ID
WHERE  CREW_BOARD_PAGENATION.CREW_BOARD_WRITER_ID = ? 
AND CREW_BOARD_PAGENATION.CRN BETWEEN ? AND ?

--제목으로 검색 (ALL_SEARCH_TITLE)
SELECT
	CREW_BOARD_PAGENATION.CRN,
	CREW_BOARD_PAGENATION.CREW_BOARD_NUM,
    CREW_BOARD_PAGENATION.CREW_BOARD_TITLE,
    CREW_BOARD_PAGENATION.CREW_BOARD_CONTENT,
    CREW_BOARD_PAGENATION.CREW_BOARD_WRITER_ID
FROM (
    SELECT 
        CREW_BOARD_NUM, 
        CREW_BOARD_TITLE, 
        CREW_BOARD_CONTENT, 
        CREW_BOARD_WRITER_ID,
        ROW_NUMBER() OVER (ORDER BY CREW_BOARD_NUM DESC) AS CRN
    FROM 
        CREW_BOARD
) CREW_BOARD_PAGENATION
JOIN
	MEMBER M
ON
	M.MEMBER_ID = CREW_BOARD_PAGENATION.CREW_BOARD_WRITER_ID
WHERE  CREW_BOARD_PAGENATION.CREW_BOARD_TITLE LIKE '%'||?||'%' 
AND CREW_BOARD_PAGENATION.CRN BETWEEN ? AND ?

--이름으로 검색 (ALL_SEARCH_NAME)
SELECT
	CREW_BOARD_PAGENATION.CRN,
	CREW_BOARD_PAGENATION.CREW_BOARD_NUM,
    CREW_BOARD_PAGENATION.CREW_BOARD_TITLE,
    CREW_BOARD_PAGENATION.CREW_BOARD_CONTENT,
    CREW_BOARD_PAGENATION.CREW_BOARD_WRITER_ID
FROM (
    SELECT 
        CREW_BOARD_NUM, 
        CREW_BOARD_TITLE, 
        CREW_BOARD_CONTENT, 
        CREW_BOARD_WRITER_ID,
        ROW_NUMBER() OVER (ORDER BY CREW_BOARD_NUM DESC) AS CRN
    FROM 
        CREW_BOARD
) CREW_BOARD_PAGENATION
JOIN
	MEMBER M
ON
	M.MEMBER_ID = CREW_BOARD_PAGENATION.CREW_BOARD_WRITER_ID
WHERE  M.MEMBER_NAME LIKE '%'||?||'%' 
AND CREW_BOARD_PAGENATION.CRN BETWEEN ? AND ?

--최신글5개만 출력
SELECT CREW_BOARD_NUM,CREW_BOARD_WRITER_ID,CREW_BOARD_CONTENT,CREW_BOARD_TITLE 
FROM (
    SELECT 
    	C.CREW_BOARD_NUM,
   		M.MEMBER_NAME,
   		C.CREW_BOARD_CONTENT,
   		C.CREW_BOARD_TITLE
    FROM 
    	CREW_BOARD C
    JOIN 
    	MEMBER M
	ON 
    	C.CREW_BOARD_WRITER_ID = M.MEMBER_ID
    ORDER BY C.CREW_BOARD_NUM DESC
) 
WHERE 
	ROWNUM <= 5;

--내용,제목 변경
UPDATE CREW_BOARD SET CREW_BOARD_CONTENT = ?, CREW_BOARD_TITLE = ? WHERE CREW_BOARD_NUM = ?

--조회수 변경
UPDATE CREW_BOARD SET CREW_BOARD_CNT = ? WHERE CREW_BOARD_NUM = ?

--페이지네이션 내 크루 글 출력
SELECT
	CB.RN,
	CB.CREW_BOARD_NUM,
	CB.CREW_BOARD_WRITER_ID,
    CB.CREW_BOARD_TITLE,
    CB.CREW_BOARD_CONTENT,
    CB.CREW_BOARD_CNT
FROM (
    SELECT 
        CREW_BOARD_NUM, 
        CREW_BOARD_WRITER_ID,
        CREW_BOARD_TITLE, 
        CREW_BOARD_CONTENT, 
        CREW_BOARD_CNT, 
        ROW_NUMBER() OVER (ORDER BY CREW_BOARD_NUM DESC) AS RN
    FROM 
        CREW_BOARD
) CB
JOIN
	MEMBER M
ON
	M.MEMBER_ID = CB.CREW_BOARD_WRITER_ID
JOIN
	CREW C
ON
	M.MEMBER_CREW_NUM = C.CREW_NUM
WHERE RN BETWEEN ? AND ?
AND C.CREW_NUM = (
	SELECT 
		MM.MEMBER_CREW_NUM
    FROM 
    	MEMBER MM
    WHERE 
    	MM.MEMBER_ID = ?
	)

--크루 커뮤니티 전체글 총 개수
SELECT COUNT(*) AS CREW_BOARD_TOTAL 
FROM 
	CREW_BOARD CB
JOIN
	MEMBER M
ON
	M.MEMBER_ID = CB.CREW_BOARD_WRITER_ID
JOIN
	CREW C
ON
	M.MEMBER_CREW_NUM = C.CREW_NUM
WHERE C.CREW_NUM = (
	SELECT 
		MM.MEMBER_CREW_NUM
    FROM 
    	MEMBER MM
    WHERE 
    	MM.MEMBER_ID = ?
	);
	
--크루 게시판 글 삭제 CREW_NUM
DELETE FROM CREW_BOARD WHERE CREW_BOARD_NUM = ?

SELECT * FROM CREW_BOARD;

DROP TABLE CREW_BOARD;